// Copyright 2013 the V8 project authors. All rights reserved.
// Copyright (C) 2005, 2006, 2007, 2008, 2009 Apple Inc. All rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions
// are met:
// 1.  Redistributions of source code must retain the above copyright
//     notice, this list of conditions and the following disclaimer.
// 2.  Redistributions in binary form must reproduce the above copyright
//     notice, this list of conditions and the following disclaimer in the
//     documentation and/or other materials provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS'' AND ANY
// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
// WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
// DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS BE LIABLE FOR ANY
// DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
// (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
// LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
// ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
// SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.


var RESULT=[];function addExceptionExpr(expr){try{RESULT.push(JSON.stringify(eval(expr)))}catch(e){RESULT.push(e.toString())}}function addReportExprStr(expr){RESULT.push(""+eval(expr))}function addReportExprJson(expr){RESULT.push(JSON.stringify(eval(expr)))}function addReportExpr(expr){RESULT.push(JSON.parse(JSON.stringify(eval(expr))))}if(!Array.isArray)Array.isArray=function(o){return o.constructor===Array};function arrayReviver(i,v){if(""!=i){currentHolder=this;addReportExpr("Array.isArray(currentHolder)");addReportExprJson("currentHolder.length",""+expectedLength);if(i>0)addReportExprJson("currentHolder","lastHolder");switch(Number(i)){case 0:v=void 0;addReportExprJson("currentHolder[0]",'"a value"');addReportExprJson("currentHolder[1]",'"another value"');addReportExprJson("currentHolder[2]",'"and another value"');addReportExprJson("currentHolder[3]",'"to delete"');addReportExprJson("currentHolder[4]",'"extra value"');break;case 1:addReportExpr("currentHolder.hasOwnProperty(0)");currentHolder[2]="a replaced value";break;case 2:addReportExprJson("currentHolder[2]",'"a replaced value"');value=v;addReportExprJson("value","currentHolder[2]");delete this[3];break;case 3:addReportExpr("currentHolder.hasOwnProperty(3)");value=v;addReportExprStr("value");this.length=3;v="undelete the property";expectedLength=4;break;case 4:if(4!=this.length){testFailed("Did not call reviver for deleted property");expectedLength=this.length=3;break}case 5:value=v;addReportExprStr("value");this[10]="fail";break;default:testFailed("Visited unexpected property "+i+" with value "+v)}}lastHolder=this;return v}expectedLength=5;var result=JSON.parse('["a value", "another value", "and another value", "to delete", "extra value"]',arrayReviver);addReportExpr("'' in lastHolder");addReportExprJson("result","lastHolder['']");addReportExpr("result.hasOwnProperty(3)");function objectReviver(i,v){if(""!=i){currentHolder=this;addReportExpr("currentHolder != globalObject");if(seen)addReportExprJson("currentHolder","lastHolder");seen=true;switch(i){case"a property":v=void 0;addReportExprJson("currentHolder['a property']",'"a value"');addReportExprJson("currentHolder['another property']",'"another value"');addReportExprJson("currentHolder['and another property']",'"and another value"');addReportExprJson("currentHolder['to delete']",'"will be deleted"');break;case"another property":addReportExpr("currentHolder.hasOwnProperty('a property')");currentHolder["and another property"]="a replaced value";break;case"and another property":addReportExprJson("currentHolder['and another property']",'"a replaced value"');value=v;addReportExprJson("value",'"a replaced value"');delete this["to delete"];break;case"to delete":addReportExpr("currentHolder.hasOwnProperty('to delete')");value=v;addReportExprStr("value");v="undelete the property";this["new property"]="fail";break;default:testFailed("Visited unexpected property "+i+" with value "+v)}}lastHolder=this;return v}var seen=false;var globalObject=this;var result=JSON.parse('{"a property" : "a value", "another property" : "another value", "and another property" : "and another value", "to delete" : "will be deleted"}',objectReviver);addReportExpr("lastHolder.hasOwnProperty('')");addReportExpr("result.hasOwnProperty('a property')");addReportExpr("result.hasOwnProperty('to delete')");addReportExprJson("result","lastHolder['']");function reviveAddsCycle(i,v){if(0==i)this[1]=this;return v}addExceptionExpr('JSON.parse("[0,1]", reviveAddsCycle)');var createdBadness=false;function reviveIntroducesNewArrayLikeObject(i,v){if(0==i&&!createdBadness){this[1]=/(a)+/.exec("a");createdBadness=true}return v}addReportExprJson('JSON.stringify(JSON.parse("[0,1]", reviveIntroducesNewArrayLikeObject))','\'[0,["a","a"]]\'');return RESULT